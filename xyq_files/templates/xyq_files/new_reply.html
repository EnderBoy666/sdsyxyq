{% extends "xyq_files/base.html" %}
{% load bootstrap4 %}
{% load static %}

{% block content %}
    <p><a href="{% url 'xyq_files:entry' entry.id %}">{{ entry }}</a></p>
    
    <p>发送评论</p>
    <form action="{% url 'xyq_files:new_reply' entry.id %}" method="post" id="reply-form">
        {% csrf_token %}
        {% bootstrap_form form %}
        
        <div class="form-group position-relative">
            <label for="reply-user-search">@用户(可选):</label>
            <input type="text" class="form-control" id="reply-user-search" placeholder="搜索用户..." autocomplete="off">
            <div id="reply-user-results" class="dropdown-menu" style="display:none; width:100%;"></div>
        </div>
        
        {% buttons %}
            <button name="submit" class="btn btn-primary">发送</button>
        {% endbuttons %}
    </form>

    <script src="{% static 'js/reply_user_search.js' %}"></script>
    
    <script>
        // 页面加载时检查URL参数并自动填充用户名
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('username');
            const receiver = urlParams.get('receiver');
            
            if (username && receiver) {
                const userSearch = document.getElementById('reply-user-search');
                const receiverInput = document.getElementById('id_receiver');
                
                if (userSearch && receiverInput) {
                    userSearch.value = '@' + username;
                    receiverInput.value = receiver;
                }
            }
        });
    </script>
{% endblock content %}